\begin{code}

{-# OPTIONS --prop --rewriting #-}

open Agda.Primitive
open import Equality
open import Logic
open import Nat
open import TTSyntax
open import SubAsList

module TTStrictifiedSyntax where

-- We can define a more strict syntax by defining _[_] by induction on terms, then mosts of the substitutions law are definitionals

ST : DepModelS*
ST = record
  { Conâ€¢   = Î» _ â†’ ğŸ™ {lzero}
  ; Tyâ€¢    = Î» _ â†’ ğŸ™ {lzero}
  ; Subâ€¢   = Î» _ _ _ â†’ ğŸ™ {lzero}
  ; Tmâ€¢    = Î» {Î“} _ {A} _ t â†’ Î£ (âˆ€{Î”} â†’ (Ïƒ :  Sub Î” Î“) â†’ Tm Î” A)
                                (Î» t[_]* â†’ (âˆ€{Î”}(Ïƒ : Sub Î” Î“) â†’ Lift ((t[ Ïƒ ]*) â‰¡ t [ Ïƒ ])))
                                
  ; â—‹â€¢     = â˜…
  ; _â–·â€¢_   = Î» _ _ â†’ â˜…
  ; _âˆ˜â€¢_   = Î» _ _ â†’ â˜…
  ; idâ€¢    = â˜…
  ; Îµâ€¢     = â˜…
  ; _â€£â€¢_   = Î» _ _ â†’ â˜…
  ; pâ€¢     = â˜…
  ; Î¹â€¢     = â˜…
  ; _â‡’â€¢_   = Î» _ _ â†’ â˜…
  
  ; _[_]â€¢  = Î» { {Î“}{_}{Î”}{_}{A}{_}{t} (t[_]* , t[_]*=) {Ïƒ} _ â†’
               (Î» {Î”'} Ïƒ' â†’ t[ Ïƒ âˆ˜ Ïƒ' ]*) ,
               (Î» {Î”'} Ïƒ' â†’ âŸª (unfold (t[ Ïƒ âˆ˜ Ïƒ' ]*=)) â–  (sym [][]) âŸ«)}
  ; qâ€¢     = Î» { {Î“}{_}{A}{_} â†’
               (Î» { {Î”'} (_ , t) â†’ t}) ,
               (Î» {Î”'} Ïƒ' â†’ âŸª sym I.q[] âŸ«)}
  ; lamâ€¢   = Î» { {Î“}{_}{A}{_}{B}{_}{t} (t[_]* , t[_]*=) â†’
               (Î» {Î”'} Ïƒ' â†’ lam (t[ Ïƒ' âˆ˜ p â€£ q ]*)) ,
               (Î» {Î”'} Ïƒ' â†’ âŸª (congâŸ¨ lam âŸ© (unfold t[ Ïƒ' âˆ˜ p â€£ q ]*=)) â–  (sym lam[]) âŸ«)}
  ; _$â€¢_   = Î» { {Î“}{_}{A}{_}{B}{_}{t} (t[_]* , t[_]*=) {u} (u[_]* , u[_]*=) â†’
               (Î» {Î”'} Ïƒ' â†’ t[ Ïƒ' ]* $ u[ Ïƒ' ]*) ,
               (Î» {Î”'} Ïƒ' â†’ âŸª (congâŸ¨ _$ u[ Ïƒ' ]* âŸ© (unfold t[ Ïƒ' ]*=)) â–  (congâŸ¨ (t [ Ïƒ' ])$_ âŸ© (unfold u[ Ïƒ' ]*=)) â–  (sym $[]) âŸ«)}
  
  ; Î²â€¢     =  Î» { {Î“}{_}{A}{_}{B}{_}{t}{t[_]* , t[_]*=}{u}{u[_]* , u[_]*=} â†’
               let Î²[_]*= = (Î» {Î”'' : Con} (Ïƒ'' : Sub Î”'' Î“) â†’
                             âŸª (congâŸ¨ (lam t[ Ïƒ'' âˆ˜ p â€£ q ]*) $_ âŸ© (unfold u[ Ïƒ'' ]*=)) â– 
                               (congâŸ¨ (Î» x â†’ (lam x) $ (u [ Ïƒ'' ])) âŸ© (unfold t[ Ïƒ'' âˆ˜ p â€£ q ]*=)) â– 
                               (congâŸ¨ _$ (u [ Ïƒ'' ]) âŸ© (sym lam[])) â– 
                               (sym $[]) âŸ«)
               in
               (funexti Î» Î”' â†’
                funext  Î» Ïƒ' â†’
                (cong$ (cong$i (transpÏ€â‚ {_}{_}{_}{_}{_}
                                         {Î» v v[_]* â†’ (âˆ€{Î”}(Ïƒ : Sub Î” Î“) â†’ Lift ((v[ Ïƒ ]*) â‰¡ v [ Ïƒ ]))}
                                         (Î² {Î“}{A}{B}{t}{u})
                                         {(Î» {Î”} (Ïƒ : Sub Î” Î“) â†’ lam t[ Ïƒ âˆ˜ p â€£ q ]* $ u[ Ïƒ ]*) , Î²[_]*=}) Î”') Ïƒ') â– 
                (unfold Î²[ Ïƒ' ]*=) â– 
                (congâŸ¨ _[ Ïƒ' ] âŸ© Î²) â– 
                ([][]) â– 
                (sym (unfold t[ (id â€£ u) âˆ˜ Ïƒ' ]*=))) ,=
               (refl) }
  ; Î·â€¢     = Î» { {Î“}{_}{A}{_}{B}{_}{t}{t[_]* , t[_]*=} â†’
             (funexti Î» Î”' â†’
              funext  Î» Ïƒ' â†’
              let Î·[_]*= = (Î» {Î”'' : Con} (Ïƒ'' : Sub Î”'' Î“) â†’
                            âŸª (congâŸ¨ (Î» x â†’ lam (t[ p âˆ˜ (Ïƒ'' âˆ˜ p â€£ q) ]* $ x)) âŸ© (sym q[])) â– 
                              (congâŸ¨ (Î» x â†’ lam (x $ (q [ Ïƒ'' âˆ˜ p â€£ q ]))) âŸ© (unfold t[ p âˆ˜ (Ïƒ'' âˆ˜ p â€£ q) ]*=)) â– 
                              (congâŸ¨ (Î» x â†’ lam (x $ (q [ Ïƒ'' âˆ˜ p â€£ q ]))) âŸ© (sym [][])) â– 
                              (congâŸ¨ lam âŸ© (sym $[])) â– 
                              (sym lam[]) âŸ«)
              in
              (cong$ (cong$i (transpÏ€â‚ {_}{_}{_}{_}{_}
                                         {Î» v v[_]* â†’ (âˆ€{Î”}(Ïƒ : Sub Î” Î“) â†’ Lift ((v[ Ïƒ ]*) â‰¡ v [ Ïƒ ]))}
                                         (Î·)
                                         { (Î» {Î”} (Ïƒ : Sub Î” Î“) â†’ lam ((t[ p âˆ˜ (Ïƒ âˆ˜ p â€£ q) ]*) $ q)) , Î·[_]*= }) Î”') Ïƒ') â– 
              (unfold Î·[ Ïƒ' ]*=) â– 
              (congâŸ¨ _[ Ïƒ' ] âŸ© Î·) â– 
              (sym (unfold t[ Ïƒ' ]*=))) ,=
             (refl)}
  ; [][]â€¢  = Î» { {Î“}{_}{Î”}{_}{Î˜}{_}{A}{_}{t}{t[_]* , t[_]*=}{Ïƒ}{_}{Ï}{_} â†’
             ((funexti Î» Î”' â†’
              funext  Î» Ïƒ' â†’
              let [][_]*= = (Î» {Î”'' : Con} (Ïƒ'' : Sub Î”'' Î˜) â†’
                            âŸª (unfold t[ Ïƒ âˆ˜ Ï âˆ˜ Ïƒ'' ]*=) â– 
                              (sym [][]) â– 
                              (sym [][]) âŸ«)
              in
              (cong$ (cong$i (transpÏ€â‚ {_}{_}{_}{_}{_}
                                         {Î» v v[_]* â†’ (âˆ€{Î”''} (Ïƒ'' : Sub Î”'' Î˜) â†’ Lift ((v[ Ïƒ'' ]*) â‰¡ v [ Ïƒ'' ]))}
                                         ([][])
                                         {(Î» {Î”''} (Ïƒ'' : Sub Î”'' Î˜) â†’ t[ Ïƒ âˆ˜ Ï âˆ˜ Ïƒ'' ]*) , [][_]*=}) Î”') Ïƒ') â– 
              (congâŸ¨ t[_]* âŸ© ass))) ,=
             (refl)}
  ; q[]â€¢   = Î» { {Î“}{_}{Î”}{_}{A}{_}{t}{t[_]* , t[_]*=}{Ïƒ}{_} â†’
               ((funexti Î» Î”' â†’
                funext  Î» Ïƒ' â†’
                (cong$ (cong$i (transpÏ€â‚ {_}{_}{_}{_}{_}
                                         {Î» v v[_]* â†’ (âˆ€{Î”''} (Ïƒ'' : Sub Î”'' Î”) â†’ Lift ((v[ Ïƒ'' ]*) â‰¡ v [ Ïƒ'' ]))}
                                         (q[])
                                         {(Î» {Î”''} (Ïƒ'' : Sub Î”'' Î”) â†’ t [ Ïƒ'' ]) , (Î» {Î”''} Ïƒ'' â†’ âŸª congâŸ¨ _[ Ïƒ'' ] âŸ© (sym q[]) âŸ«)}) Î”') Ïƒ') â– 
                 (sym (unfold t[ Ïƒ' ]*=)))) ,=
                 (refl)}
  ; lam[]â€¢ = Î» { {Î“}{_}{Î”}{_}{A}{_}{B}{_}{t}{t[_]* , t[_]*=}{Ïƒ}{_} â†’
               (funexti Î» Î”' â†’
                funext  Î» Ïƒ' â†’
                let lam[_]*= = (Î» {Î”'' : Con} (Ïƒ'' : Sub Î”'' Î”) â†’
                               âŸª (congâŸ¨ lam âŸ© (unfold t[ (Ïƒ âˆ˜ Ïƒ'') âˆ˜ p â€£ q ]*=)) â– 
                                 (sym lam[]) â– 
                                 (sym [][]) âŸ«)
                in
                (cong$ (cong$i (transpÏ€â‚ {_}{_}{_}{_}{_}
                                         {Î» v v[_]* â†’ (âˆ€{Î”''}(Ïƒ'' : Sub Î”'' Î”) â†’ Lift ((v[ Ïƒ'' ]*) â‰¡ v [ Ïƒ'' ]))}
                                         (lam[])
                                         {(Î» {Î”''} (Ïƒ'' : Sub Î”'' Î”) â†’ lam t[ (Ïƒ âˆ˜ Ïƒ'') âˆ˜ p â€£ q ]*) , lam[_]*= }) Î”') Ïƒ') â– 
                (unfold lam[ Ïƒ' ]*=) â– 
                (congâŸ¨ _[ Ïƒ' ] âŸ© lam[]) â– 
                (lam[]) â– 
                (congâŸ¨ lam âŸ© [][]) â– 
                (congâŸ¨ lam âŸ© (sym (unfold t[ (Ïƒ âˆ˜ p â€£ q) âˆ˜ (Ïƒ' âˆ˜ p â€£ q) ]*=)))) ,=
               (refl)}
  ; $[]â€¢   = Î» { {Î“}{_}{Î”}{_}{A}{_}{B}{_}{t}{t[_]* , t[_]*=}{u}{u[_]* , u[_]*=}{Ïƒ}{_} â†’
               (funexti Î» Î”' â†’
                funext  Î» Ïƒ' â†’
                let $[_]*= = (Î» {Î”'' : Con} (Ïƒ'' : Sub Î”'' Î”) â†’
                             âŸª (congâŸ¨ _$ u[ Ïƒ âˆ˜ Ïƒ'' ]* âŸ© (unfold t[ Ïƒ âˆ˜ Ïƒ'' ]*=)) â– 
                               (congâŸ¨ (t [ Ïƒ âˆ˜ Ïƒ'' ]) $_ âŸ© (unfold u[ Ïƒ âˆ˜ Ïƒ'' ]*=)) â– 
                               (sym $[]) â– 
                               (sym [][]) âŸ«)
                in
                (cong$ (cong$i (transpÏ€â‚ {_}{_}{_}{_}{_}
                                         {Î» v v[_]* â†’ (âˆ€{Î”''}(Ïƒ'' : Sub Î”'' Î”) â†’ Lift ((v[ Ïƒ'' ]*) â‰¡ v [ Ïƒ'' ]))}
                                         ($[])
                                         {(Î» {Î”''} (Ïƒ'' : Sub Î”'' Î”) â†’ (t[ Ïƒ âˆ˜ Ïƒ'' ]* $ u[ Ïƒ âˆ˜ Ïƒ'' ]*)) , $[_]*= }) Î”') Ïƒ') â– 
                refl) ,=
               (refl)}
  ; t[id]â€¢ = Î» { {Î“}{_}{A}{_}{t}{t[_]* , t[_]*=} â†’
               ( (funexti Î» Î”' â†’
                funext  Î» Ïƒ' â†’
                let t[id][_]*= = (Î» {Î”'' : Con} (Ïƒ'' : Sub Î”'' Î“) â†’
                               âŸª (unfold t[ id âˆ˜ Ïƒ'' ]*=) â– 
                                 (sym [][]) âŸ«)
                in
                (cong$ (cong$i (transpÏ€â‚ {_}{_}{_}{_}{_}
                                         {Î» v v[_]* â†’ (âˆ€{Î”''}(Ïƒ'' : Sub Î”'' Î“) â†’ Lift ((v[ Ïƒ'' ]*) â‰¡ v [ Ïƒ'' ]))}
                                         (t[id])
                                         {(Î» {Î”''} (Ïƒ'' : Sub Î”'' Î“) â†’ t[ id âˆ˜ Ïƒ'' ]*) , t[id][_]*= }) Î”') Ïƒ') â– 
                (congâŸ¨ t[_]* âŸ© idl))) ,=
               (refl)}
  ; assâ€¢   = refl
  ; idlâ€¢   = Î» { {Ïƒâ€¢ = â˜…} â†’ refl }
  ; idrâ€¢   = Î» { {Ïƒâ€¢ = â˜…} â†’ refl }
  ; â—‹Î·â€¢    = Î» { {Ïƒâ€¢ = â˜…} â†’ refl }
  ; â–·Î²â€¢    = Î» { {Ïƒâ€¢ = â˜…} â†’ refl } 
  ; â–·Î·â€¢    = Î» { {Ïƒâ€¢ = â˜…} â†’ refl }
  } where open S*
module ST = DepModelS* ST

-- Then the model looks like :

I* : Model
I* = record
   { Con   = S*.Con
   ; Ty    = S*.Ty
   ; Sub   = S*.Sub
   ; Tm    = S*.Tm
   ; â—‹     = S*.â—‹
   ; _â–·_   = S*._â–·_
   ; Î¹     = S*.Î¹
   ; _â‡’_   = S*._â‡’_
   ; _âˆ˜_   = S*._âˆ˜_
   ; id    = S*.id
   ; Îµ     = â˜…
   ; _â€£_   = S*._â€£_
   ; p     = S*.p
   ; _[_]  = Î» t â†’ Ï€â‚ ST.âŸ¦ t âŸ§â€¢t
   ; q     = S*.q
   ; lam   = S*.lam
   ; _$_   = S*._$_
   ; Î²     = Î» {Î“}{A}{B}{t}{u} â†’ S*.Î² â–  (sym (unfold (Ï€â‚‚ (ST.âŸ¦ t âŸ§â€¢t) (S*.id S*.â€£ u))))
   ; Î·     = Î» {Î“}{A}{B}{t} â†’ (congâŸ¨ (Î» x â†’ S*.lam (x I.$ I.q)) âŸ© (unfold (Ï€â‚‚ (ST.âŸ¦ t âŸ§â€¢t) S*.p))) â–  S*.Î·
   ; [][]  = Î» {Î“}{Î”}{Î˜}{A}{t}{Ïƒ}{Ï} â†’ congâŸ¨ (Î» x â†’ Ï€â‚ ST.âŸ¦ x âŸ§â€¢t Ï) âŸ© (unfold (Ï€â‚‚ ST.âŸ¦ t âŸ§â€¢t Ïƒ))
   ; q[]   = refl
   ; lam[] = refl
   ; $[]   = refl
   ; t[id] = Î» {Î“}{A}{t} â†’ (unfold (Ï€â‚‚ (ST.âŸ¦ t âŸ§â€¢t) S*.id)) â–  S*.t[id] 
   ; ass   = S*.ass
   ; idl   = S*.idl
   ; idr   = S*.idr
   ; â—‹Î·    = refl
   ; â–·Î²    = S*.â–·Î²
   ; â–·Î·    = (refl ,= sym I.q[]) â–  S*.â–·Î·
   }
module I* = Model I*

-- We still need to show it is equivalent to the syntax :
-- only terms are modified, and one form is not definitionaly the same :

[]comp : âˆ€{Î“ Î”}{A}{t : I*.Tm Î“ A}{Ïƒ : I*.Sub Î” Î“} â†’ t I*.[ Ïƒ ] â‰¡ t S*.[ Ïƒ ]
[]comp {Î“}{Î”}{A}{t}{Ïƒ} = unfold (Ï€â‚‚ ST.âŸ¦ t âŸ§â€¢t Ïƒ)

-- Then we can derive a new DepModel using this syntax !
