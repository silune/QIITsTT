\begin{code}

{-# OPTIONS --prop --rewriting #-}

open Agda.Primitive
open import Equality
open import Logic
open import Nat
open import TTSyntax

module SubAsList where

module NormalSub where

  open I

  -- let us interpret substitutions as lists of Terms :

  Sub* : Con â†’ Con â†’ Set
  Sub* Î” I.â—‹ = ğŸ™
  Sub* Î” (Î“ I.â–· A) = Sub* Î” Î“ Ã— I.Tm Î” A

  -- then we can define the unquote function from Sub* to Sub

  âŒœ_âŒ : âˆ€{Î“ Î”} â†’ Sub* Î” Î“ â†’ Sub Î” Î“
  âŒœ_âŒ {â—‹} â˜… = Îµ
  âŒœ_âŒ {Î“ â–· A} (Ïƒ , t) = âŒœ Ïƒ âŒ â€£ t

  -- as well we have all the operators,
  -- where Îµ is â˜… and _â€£_ the Î£ type constructor _,_

  _âˆ˜*_ : âˆ€{Î“ Î” Î˜} â†’ Sub* Î” Î“ â†’ Sub* Î˜ Î” â†’ Sub* Î˜ Î“
  id* : âˆ€{Î“} â†’ Sub* Î“ Î“
  wk : âˆ€{Î“ Î”}{B} â†’ Sub* Î” Î“ â†’ Sub* (Î” â–· B) Î“
  p* : âˆ€{Î“}{A} â†’ Sub* (Î“ â–· A) Î“
  
  p* = wk id*
  
  _âˆ˜*_ {I.â—‹} â˜… Ï = â˜…
  _âˆ˜*_ {Î“ I.â–· A} (Ïƒ , t) Ï = (Ïƒ âˆ˜* Ï) , t [ âŒœ Ï âŒ  ]

  wk {â—‹} â˜… = â˜…
  wk {Î“ â–· A} (Ïƒ , t) = wk Ïƒ , (t [ p ])

  id* {â—‹} = â˜…
  id* {Î“ â–· A} = wk id* , q

  -- Then We need to show that the unquote function is morphism : 

  âŒœâˆ˜âŒ : âˆ€{Î“ Î” Î˜}{Ïƒ* : Sub* Î” Î“}{Ï* : Sub* Î˜ Î”} â†’ âŒœ Ïƒ* âˆ˜* Ï* âŒ â‰¡ âŒœ Ïƒ* âŒ âˆ˜ âŒœ Ï* âŒ 
  âŒœâˆ˜âŒ {â—‹}{Î”}{Î˜}{â˜…}{Ï*} = (sym â—‹Î·)
  âŒœâˆ˜âŒ {Î“ â–· A}{Î”}{Î˜}{Ïƒ , t}{Ï*} = (congâŸ¨ _â€£ t [ âŒœ Ï* âŒ ] âŸ© âŒœâˆ˜âŒ) â–  (sym subDist)

  âŒœwkâŒ : âˆ€{Î“ Î”}{B}{Ïƒ* : Sub* Î” Î“} â†’ âŒœ wk {Î“}{Î”}{B} Ïƒ* âŒ â‰¡ âŒœ Ïƒ* âŒ âˆ˜ p
  âŒœwkâŒ {â—‹}{Î”}{B}{â˜…} = sym â—‹Î·
  âŒœwkâŒ {Î“ â–· A}{Î”}{B}{Ïƒ , t} = (congâŸ¨ _â€£ t [ p ] âŸ© âŒœwkâŒ) â–  (sym subDist)

  âŒœidâŒ : âˆ€{Î“} â†’ âŒœ id* âŒ â‰¡ id {Î“}
  âŒœidâŒ {â—‹} = (sym â—‹Î·)
  âŒœidâŒ {Î“ â–· A} = (congâŸ¨ _â€£ q âŸ© âŒœwkâŒ) â– 
                 (congâŸ¨ (Î» x â†’ x âˆ˜ p â€£ q) âŸ© âŒœidâŒ) â– 
                 (congâŸ¨ _â€£ q âŸ© (idl â–  (sym idr))) â– 
                 (congâŸ¨ p âˆ˜ id â€£_ âŸ© (sym t[id])) â– 
                 (â–·Î·)

  âŒœpâŒ : âˆ€{Î“}{B} â†’ âŒœ p* âŒ â‰¡ p {Î“}{B} 
  âŒœpâŒ {â—‹}{B} = sym â—‹Î·
  âŒœpâŒ {Î“ â–· A}{B} = (congâŸ¨ _â€£ q [ p ] âŸ© âŒœwkâŒ) â–  (congâŸ¨ (Î» x â†’ x âˆ˜ p â€£ q [ p ]) âŸ© âŒœpâŒ) â–  â–·Î·

  âŒœÎµâŒ : âˆ€{Î“} â†’ âŒœ â˜… âŒ â‰¡ Îµ {Î“}
  âŒœÎµâŒ = refl

  âŒœâ€£âŒ : âˆ€{Î“ Î”}{A}{Ïƒ : Sub* Î” Î“}{t : Tm Î” A} â†’ âŒœ Ïƒ , t âŒ â‰¡ âŒœ Ïƒ âŒ â€£ t
  âŒœâ€£âŒ = refl

  -- and finally prove the equations on substitutions

  ass* : âˆ€{Î“ Î” Î˜ Î©}{Ïƒ : Sub* Î” Î“}{Ï : Sub* Î˜ Î”}{Î³ : Sub* Î© Î˜} â†’ (Ïƒ âˆ˜* (Ï âˆ˜* Î³)) â‰¡ ((Ïƒ âˆ˜* Ï) âˆ˜* Î³)
  ass* {â—‹}{Î”}{Î˜}{Î©}{Ïƒ*}{Ï*}{Î³*} = refl
  ass* {Î“ â–· A}{Î”}{Î˜}{Î©}{Ïƒ* , t}{Ï*}{Î³*} = ass* ,= ((congâŸ¨ t [_] âŸ© âŒœâˆ˜âŒ) â–  (sym [][]))

  â–·Î²** : âˆ€{Î˜ Î“ Î”}{A}{Ï : Sub* Î“ Î˜}{Ïƒ : Sub* Î” Î“}{u : Tm Î” A} â†’ (wk Ï âˆ˜* (Ïƒ , u)) â‰¡ Ï âˆ˜* Ïƒ
  â–·Î²** {â—‹}{Î“}{Î”}{A}{â˜…}{Ïƒ}{u} = refl
  â–·Î²** {Î˜ â–· B}{Î“}{Î”}{A}{Ï , t}{Ïƒ}{u} = â–·Î²** ,= ([][] â–  (congâŸ¨ t [_] âŸ© â–·Î²))

  idl* : âˆ€{Î“ Î”}{Ïƒ : Sub* Î” Î“} â†’ (id* âˆ˜* Ïƒ) â‰¡ Ïƒ
  
  â–·Î²* : âˆ€{Î“ Î”}{A}{Ïƒ : Sub* Î” Î“}{u : Tm Î” A} â†’ (wk id* âˆ˜* (Ïƒ , u)) â‰¡ Ïƒ
  â–·Î²* {Î“}{Î”}{A}{Ïƒ}{u} = â–·Î²** â–  idl*
  
  idl* {â—‹}{Î”}{Ïƒ} = refl
  idl* {Î“ â–· A}{Î”}{Ïƒ , t} = â–·Î²* ,= q[]

  â–·Î·* : âˆ€{Î“ Î”}{A}{Ïƒ : Sub* Î” (Î“ â–· A)} â†’ ((p* âˆ˜* Ïƒ) , q [ âŒœ Ïƒ âŒ ]) â‰¡ Ïƒ
  â–·Î·* {Î“}{Î”}{A}{Ïƒ , t} = â–·Î²* ,= q[]

  idr* : âˆ€{Î“ Î”}{Ïƒ : Sub* Î” Î“} â†’ (Ïƒ âˆ˜* id*) â‰¡ Ïƒ
  idr* {â—‹}{Î”}{Ïƒ} = refl
  idr* {Î“ â–· A}{Î”}{Ïƒ , t} = idr* ,= ((congâŸ¨ t [_] âŸ© âŒœidâŒ) â–  t[id])


S* : Model
S* = record
   { Con   = Con
   ; Ty    = Ty
   ; Sub   = Sub* 
   ; Tm    = Tm
   ; â—‹     = â—‹
   ; _â–·_   = _â–·_
   ; Î¹     = Î¹
   ; _â‡’_   = _â‡’_
   ; _âˆ˜_   = _âˆ˜*_
   ; id    = id*
   ; Îµ     = â˜…
   ; _â€£_   = _,_
   ; p     = p*
   ; _[_]  = Î» t Ïƒ â†’ t [ âŒœ Ïƒ âŒ ]
   ; q     = q
   ; lam   = lam
   ; _$_   = _$_
   ; Î²     = Î» {Î“}{A}{B}{t}{u} â†’
             Î² â–  congâŸ¨ (Î» x â†’ t [ x â€£ u ]) âŸ© (sym âŒœidâŒ)
   ; Î·     = Î» {Î“}{A}{B}{t} â†’
             congâŸ¨ (Î» x â†’ lam ((t [ x ]) $ q)) âŸ© âŒœpâŒ â–  Î·
   ; [][]  = Î» {Î“}{Î”}{Î˜}{A}{t}{Ïƒ}{Ï} â†’
             [][] â–  congâŸ¨ t [_] âŸ© (sym âŒœâˆ˜âŒ)
   ; q[]   = Î» {Î“}{Î”}{A}{t}{Ïƒ} â†’
             q[]
   ; lam[] = Î» {Î“}{Î”}{A}{B}{t}{Ïƒ} â†’
             lam[] â–  (congâŸ¨ (Î» x â†’ lam (t [ âŒœ Ïƒ âŒ âˆ˜ x â€£ q ])) âŸ© (sym âŒœpâŒ)) â–  (congâŸ¨ (Î» x â†’ lam (t [ x â€£ q ])) âŸ© (sym âŒœâˆ˜âŒ))
   ; $[]   = Î» {Î“}{Î”}{A}{B}{t}{u}{Ïƒ} â†’
             $[]
   ; t[id] = Î» {Î“}{A}{t} â†’
             (congâŸ¨ t [_] âŸ© âŒœidâŒ) â–  t[id]
   ; ass   = ass*
   ; idl   = idl*
   ; idr   = idr*
   ; â—‹Î·    = refl
   ; â–·Î²    = â–·Î²*
   ; â–·Î·    = â–·Î·*
   } where open I ; open NormalSub
module S* = Model S*

-- then we need to prove this is a Syntax, only substitution are changed so we will juste show the following :

open NormalSub

-- we need a type and context conversion ??? why

compT : âˆ€{A} â†’ S*.âŸ¦ A âŸ§T â‰¡ A
compT {I.Î¹} = refl
compT {A I.â‡’ B} = (congâŸ¨ I._â‡’ S*.âŸ¦ B âŸ§T âŸ© (compT {A})) â–  (congâŸ¨ A I.â‡’_ âŸ© (compT {B}))

compC : âˆ€{Î“} â†’ S*.âŸ¦ Î“ âŸ§C â‰¡ Î“
compC {I.â—‹} = refl
compC {Î“ I.â–· A} = (congâŸ¨ I._â–· S*.âŸ¦ A âŸ§T âŸ© (compC {Î“})) â–  (congâŸ¨ Î“ I.â–·_ âŸ© (compT {A}))

transpt : âˆ€{Î“}{A} â†’ I.Tm (S*.âŸ¦ Î“ âŸ§C) (S*.âŸ¦ A âŸ§T) â†’ I.Tm Î“ A
transpt {Î“}{A} t = transpâŸ¨ (Î» x â†’ I.Tm (Ï€â‚ x) (Ï€â‚‚ x)) âŸ© (compC {Î“} ,= compT {A}) t

compq : âˆ€{Î“}{A} â†’ transpt (S*.âŸ¦ I.q {Î“}{A} âŸ§t) â‰¡ I.q {Î“}{A}
compq {Î“}{A} = sym (transp$ {_}{_}{_}{Î» x â†’ I.Tm ((Ï€â‚ x) I.â–· (Ï€â‚‚ x)) (Ï€â‚‚ x)} (Î» x _ â†’ I.q {Ï€â‚ x}{Ï€â‚‚ x}) (compC {Î“} ,= compT {A}) {S*.âŸ¦ I.q {Î“}{A} âŸ§t})

transpS : âˆ€{Î“ Î”} â†’ S*.Sub (S*.âŸ¦ Î” âŸ§C) (S*.âŸ¦ Î“ âŸ§C) â†’ S*.Sub Î” Î“
transpS {Î“}{Î”} = transpâŸ¨ (Î» x â†’ Sub* (Ï€â‚ x) (Ï€â‚‚ x)) âŸ© (compC {Î”} ,= compC {Î“}) 

transpâŒœâŒ : âˆ€{Î“}{Î”}{Ïƒ* : Sub* S*.âŸ¦ Î” âŸ§C S*.âŸ¦ Î“ âŸ§C} â†’ âŒœ transpS Ïƒ* âŒ â‰¡ transpâŸ¨ (Î» x â†’ I.Sub (Ï€â‚ x) (Ï€â‚‚ x)) âŸ© (compC {Î”} ,= compC {Î“}) âŒœ Ïƒ* âŒ
transpâŒœâŒ {Î“}{Î”}{Ïƒ*} = transp$ (Î» x (Ïƒ'* : Sub* (Ï€â‚ x) (Ï€â‚‚ x)) â†’ âŒœ Ïƒ'* âŒ) (compC {Î”} ,= compC {Î“})

transpâ€£* : âˆ€{Î“}{Î”}{A}{Ïƒ* : Sub* S*.âŸ¦ Î” âŸ§C S*.âŸ¦ Î“ âŸ§C}{t : I.Tm S*.âŸ¦ Î” âŸ§C S*.âŸ¦ A âŸ§T} â†’ transpS {Î“ I.â–· A}{Î”} (Ïƒ* , t) â‰¡ (transpS Ïƒ*) , (transpt t)
transpâ€£* {Î“}{Î”}{A}{Ïƒ*}{t} = transpÃ— {_}{_}{_}{Î» x â†’ Sub* (Ï€â‚ x) (Ï€â‚ (Ï€â‚‚ x))}{_}{Î» x â†’ I.Tm (Ï€â‚ x) (Ï€â‚‚ (Ï€â‚‚ x))}{_}{_}{Ïƒ* , t} (compC {Î”} ,= compC {Î“} ,= compT {A})

transpâˆ˜* : âˆ€{Î“}{Î”}{Î˜}{Ïƒ* : Sub* S*.âŸ¦ Î” âŸ§C S*.âŸ¦ Î“ âŸ§C}{Ï* : Sub* S*.âŸ¦ Î˜ âŸ§C S*.âŸ¦ Î” âŸ§C} â†’ transpS (Ïƒ* âˆ˜* Ï*) â‰¡ (transpS Ïƒ*) âˆ˜* (transpS Ï*)
transpâˆ˜* {Î“}{Î”}{Î˜}{Ïƒ*}{Ï*} = (transpâˆ˜ (Î» {Î˜' Î”' Î“'} (Ï' : Sub* Î˜' Î”') (Ïƒ' : Sub* Î”' Î“') â†’ Ïƒ' âˆ˜* Ï') (compC {Î˜}) (compC {Î”}) (compC {Î“}))

transpid* : âˆ€{Î“} â†’ transpS (id* {S*.âŸ¦ Î“ âŸ§C}) â‰¡ id* {Î“}
transpid* {Î“} = (sym (transp$ {_}{_}{_}{Î» x â†’ Sub* x x}{_}{Î» a â†’ Sub* a a} (Î» x _ â†’ id* {x}) (compC {Î“}) {S*.âŸ¦ I.id {Î“} âŸ§S}))

compProof : DepModel
compProof = record
  { Conâ€¢   = Î» _ â†’ ğŸ™ {lzero}
  ; Tyâ€¢    = Î» _ â†’ ğŸ™ {lzero}
  ; Subâ€¢   = Î» {Î”} _ {Î“} _ Ïƒ â†’ Lift (âŒœ transpS S*.âŸ¦ Ïƒ âŸ§S âŒ â‰¡ Ïƒ)
  ; Tmâ€¢    = Î» {Î“} _ {A} _ t â†’ Lift (transpt S*.âŸ¦ t âŸ§t â‰¡ t)
  ; â—‹â€¢     = â˜…
  ; _â–·â€¢_   = Î» _ _ â†’ â˜…
  ; _âˆ˜â€¢_   = Î» {Î“}{_}{Î”}{_}{Î˜}{_}{Ïƒ} compÏƒ {Ï} compÏ â†’
             âŸª (congâŸ¨ âŒœ_âŒ âŸ© transpâˆ˜*) â– 
               (âŒœâˆ˜âŒ) â– 
               (congâŸ¨ âŒœ transpS S*.âŸ¦ Ïƒ âŸ§S âŒ I.âˆ˜_ âŸ© (unfold compÏ)) â– 
               (congâŸ¨ I._âˆ˜ Ï âŸ© (unfold compÏƒ))  âŸ«
  ; idâ€¢    = Î» {Î“}{A} â†’
             âŸª (transp$ (Î» x (Ïƒ* : Sub* (Ï€â‚ x) (Ï€â‚‚ x)) â†’ âŒœ Ïƒ* âŒ) (compC {Î“} ,= compC {Î“})) â– 
               (congâŸ¨ transpâŸ¨ (Î» x â†’ I.Sub (Ï€â‚ x) (Ï€â‚‚ x)) âŸ© (compC {Î“} ,= compC {Î“}) âŸ© âŒœidâŒ) â– 
               (sym (transp$ (Î» Î“ _ â†’ I.id {Î“}) (compC {Î“}) {Î“})) âŸ«
  ; Îµâ€¢     = âŸª refl âŸ«
  ; _â€£â€¢_   = Î» {Î“}{_}{Î”}{_}{A}{_}{Ïƒ} compÏƒ {t} compt â†’ 
             âŸª (congâŸ¨ (Î» x â†’ âŒœ Ï€â‚ x âŒ I.â€£ (Ï€â‚‚ (transpS {Î“ I.â–· A} S*.âŸ¦ Ïƒ I.â€£ t âŸ§S))) âŸ© transpâ€£*) â– 
               (congâŸ¨ I._â€£ (Ï€â‚‚ (transpS {Î“ I.â–· A} S*.âŸ¦ Ïƒ I.â€£ t âŸ§S)) âŸ© (unfold compÏƒ)) â– 
               (congâŸ¨ (Î» x â†’ Ïƒ I.â€£ (Ï€â‚‚ x)) âŸ© (transpâ€£* {Î“}{Î”}{A}{S*.âŸ¦ Ïƒ âŸ§S}{S*.âŸ¦ t âŸ§t})) â– 
               (congâŸ¨ Ïƒ I.â€£_ âŸ© (unfold compt)) âŸ«
  ; pâ€¢     = Î» {Î“}{_}{A} â†’
             âŸª (transpâŒœâŒ) â– 
               (congâŸ¨ transpâŸ¨ (Î» x â†’ I.Sub (Ï€â‚ x) (Ï€â‚‚ x)) âŸ© (compC ,= compC) âŸ© âŒœpâŒ) â– 
               (sym (transp$ {_}{_}{_}{(Î» x â†’ I.Sub ((Ï€â‚ x) I.â–· (Ï€â‚‚ x)) (Ï€â‚ x))} (Î» x _ â†’ I.p {Ï€â‚ x}{Ï€â‚‚ x}) (compC {Î“} ,= compT {A}) {âŒœ S*.âŸ¦ I.p {Î“}{A} âŸ§S âŒ}))  âŸ«
  ; Î¹â€¢     = â˜…
  ; _â‡’â€¢_   = Î» _ _ â†’ â˜…
  ; _[_]â€¢  = Î» {Î“}{_}{Î”}{_}{A}{_}{u} compu {Ïƒ} compÏƒ â†’
             âŸª (((sym (transp$â‚‚ {_}{I.Con Ã— (I.Con Ã— I.Ty)}
                                {_}{Î» x â†’ I.Tm (Ï€â‚ x) (Ï€â‚‚ (Ï€â‚‚ x))}
                                {_}{Î» x â†’ I.Sub (Ï€â‚ (Ï€â‚‚ x)) (Ï€â‚ x)}
                                (Î» _ â†’ I._[_])
                                (compC {Î“} ,Ã—= (compC {Î”} ,Ã—= compT {A})))) â– 
               (congâŸ¨ transpâŸ¨ (Î» x â†’ I.Tm (Ï€â‚ x) (Ï€â‚‚ (Ï€â‚‚ x))) âŸ© (compC {Î“} ,Ã—= (compC {Î”} ,Ã—= compT {A})) S*.âŸ¦ u âŸ§t I.[_] âŸ© (sym transpâŒœâŒ))) â– 
               (congâŸ¨ I._[ âŒœ transpS S*.âŸ¦ Ïƒ âŸ§S âŒ ] âŸ© (unfold compu))) â– 
               (congâŸ¨ u I.[_] âŸ© (unfold compÏƒ)) âŸ«
  ; qâ€¢     = âŸª compq âŸ«
  ; lamâ€¢   = Î» {Î“}{_}{A}{_}{B}{_}{t} compt â†’
             âŸª (sym (transp$ {_}{I.Con Ã— (I.Ty Ã— I.Ty)}
                             {_}{Î» x â†’ I.Tm ((Ï€â‚ x) I.â–· (Ï€â‚ (Ï€â‚‚ x))) (Ï€â‚‚ (Ï€â‚‚ x))}
                             (Î» _ â†’ I.lam)
                             (compC {Î“} ,Ã—= (compT {A} ,Ã—= compT {B})))) â– 
               (congâŸ¨ I.lam âŸ© (unfold compt)) âŸ«
  ; _$â€¢_   = Î» {Î“}{_}{A}{_}{B}{_}{t} compt {u} compu â†’
             âŸª (sym (transp$â‚‚ {_}{I.Con Ã— (I.Ty Ã— I.Ty)}
                              {_}{Î» x â†’ I.Tm (Ï€â‚ x) ((Ï€â‚ (Ï€â‚‚ x)) I.â‡’ (Ï€â‚‚ (Ï€â‚‚ x)))}
                              (Î» _ â†’ I._$_)
                              (compC {Î“} ,Ã—= (compT {A} ,Ã—= compT {B})))) â– 
               (congâŸ¨ I._$ (transpt S*.âŸ¦ u âŸ§t) âŸ© (unfold compt)) â– 
               (congâŸ¨ t I.$_ âŸ© (unfold compu)) âŸ«
               
  ; Î²â€¢ = refl ; Î·â€¢ = refl ; [][]â€¢ = refl ; q[]â€¢ = refl ; lam[]â€¢ = refl ; $[]â€¢ = refl ; t[id]â€¢ = refl
  ; assâ€¢ = refl ; idlâ€¢ = refl ; idrâ€¢ = refl ; â—‹Î·â€¢ = refl ; â–·Î²â€¢ = refl ; â–·Î·â€¢ = refl
  }
module compProof = DepModel compProof

compS : âˆ€{Î“}{Î”}{Ïƒ : I.Sub Î” Î“} â†’ âŒœ transpS S*.âŸ¦ Ïƒ âŸ§S âŒ â‰¡ Ïƒ
compS {Î“}{Î”}{Ïƒ} = unfold (compProof.âŸ¦ Ïƒ âŸ§â€¢S)

compt : âˆ€{Î“}{A}{t : I.Tm Î“ A} â†’ transpt S*.âŸ¦ t âŸ§t â‰¡ t
compt {Î“}{A}{t} = unfold (compProof.âŸ¦ t âŸ§â€¢t)

-- We can derive a new constructor for DepModel :

record DepModelS* {lc}{ls}{lty}{ltm} : Set (lsuc (lc âŠ” ls âŠ” lty âŠ” ltm)) where

  infixr 6 _[_]â€¢
  infixr 7 _$â€¢_
  infixr 5 _â–·â€¢_
  infixr 6 _âˆ˜â€¢_
  infixr 5 _â€£â€¢_

  open S*

  field
  
    Conâ€¢   : Con â†’ Set lc
    Tyâ€¢    : Ty â†’ Set lty
    Subâ€¢   : âˆ€{Î”} â†’ Conâ€¢ Î” â†’ âˆ€{Î“} â†’ Conâ€¢ Î“ â†’ Sub Î” Î“ â†’ Set ls
    Tmâ€¢    : âˆ€{Î“} â†’ (Î“â€¢ : Conâ€¢ Î“) â†’ âˆ€{A} â†’ Tyâ€¢ A â†’ Tm Î“ A â†’ Set ltm
    
    â—‹â€¢     : Conâ€¢ â—‹
    _â–·â€¢_   : âˆ€{Î“} â†’ (Î“â€¢ : Conâ€¢ Î“) â†’ âˆ€{A} â†’ Tyâ€¢ A â†’ Conâ€¢ (Î“ â–· A) 

    _âˆ˜â€¢_   : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{Î˜}{Î˜â€¢ : Conâ€¢ Î˜}{Ïƒ} â†’ Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ â†’ âˆ€{Ï} â†’ Subâ€¢ Î˜â€¢ Î”â€¢ Ï â†’ Subâ€¢ Î˜â€¢ Î“â€¢ (Ïƒ âˆ˜ Ï)
    idâ€¢    : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“} â†’ Subâ€¢ Î“â€¢ Î“â€¢ id
    Îµâ€¢     : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“} â†’ Subâ€¢ Î“â€¢ â—‹â€¢ (Îµ {Î“})
    _â€£â€¢_   : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{A}{Aâ€¢ : Tyâ€¢ A}{Ïƒ} â†’ Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ â†’ âˆ€{t} â†’ Tmâ€¢ Î”â€¢ Aâ€¢ t â†’ Subâ€¢ Î”â€¢ (Î“â€¢ â–·â€¢ Aâ€¢) (Ïƒ â€£ t)
    pâ€¢     : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{A}{Aâ€¢ : Tyâ€¢ A} â†’ Subâ€¢ (Î“â€¢ â–·â€¢ Aâ€¢) Î“â€¢ p

    Î¹â€¢     : Tyâ€¢ I.Î¹
    _â‡’â€¢_   : âˆ€{A}{B} â†’ Tyâ€¢ A â†’ Tyâ€¢ B â†’ Tyâ€¢ (A I.â‡’ B)

    _[_]â€¢  : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{A}{Aâ€¢ : Tyâ€¢ A}{u} â†’ Tmâ€¢ Î“â€¢ Aâ€¢ u â†’ âˆ€{Ïƒ} â†’ (Ïƒâ€¢ : Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ) â†’
             Tmâ€¢ Î”â€¢ Aâ€¢ (u [ Ïƒ ])
    qâ€¢     : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{A}{Aâ€¢ : Tyâ€¢ A} â†’
             Tmâ€¢ (Î“â€¢ â–·â€¢ Aâ€¢) Aâ€¢ q
    lamâ€¢   : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{A}{Aâ€¢ : Tyâ€¢ A}{B}{Bâ€¢ : Tyâ€¢ B}{t} â†’ Tmâ€¢ (Î“â€¢ â–·â€¢ Aâ€¢) Bâ€¢ t â†’
             Tmâ€¢ Î“â€¢ (Aâ€¢ â‡’â€¢ Bâ€¢) (lam t)
    _$â€¢_   : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{A}{Aâ€¢ : Tyâ€¢ A}{B}{Bâ€¢ : Tyâ€¢ B}{t} â†’ Tmâ€¢ Î“â€¢ (Aâ€¢ â‡’â€¢ Bâ€¢) t â†’ âˆ€{u} â†’ Tmâ€¢ Î“â€¢ Aâ€¢ u â†’
             Tmâ€¢ Î“â€¢ Bâ€¢ (t $ u)

    Î²â€¢     : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{A}{Aâ€¢ : Tyâ€¢ A}{B}{Bâ€¢ : Tyâ€¢ B}{t}{tâ€¢ : Tmâ€¢ (Î“â€¢ â–·â€¢ Aâ€¢) Bâ€¢ t}{u}{uâ€¢ : Tmâ€¢ Î“â€¢ Aâ€¢ u} â†’
             transpâŸ¨ Tmâ€¢ Î“â€¢ Bâ€¢ âŸ© Î² ((lamâ€¢ tâ€¢) $â€¢ uâ€¢) â‰¡ tâ€¢ [ idâ€¢ â€£â€¢ uâ€¢ ]â€¢
    Î·â€¢     : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{A}{Aâ€¢ : Tyâ€¢ A}{B}{Bâ€¢ : Tyâ€¢ B}{t}{tâ€¢ : Tmâ€¢ Î“â€¢ (Aâ€¢ â‡’â€¢ Bâ€¢) t} â†’
             transpâŸ¨ Tmâ€¢ Î“â€¢ (Aâ€¢ â‡’â€¢ Bâ€¢) âŸ© Î· (lamâ€¢ ((tâ€¢ [ pâ€¢ ]â€¢) $â€¢ qâ€¢)) â‰¡ tâ€¢
    [][]â€¢  : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{Î˜}{Î˜â€¢ : Conâ€¢ Î˜}{A}{Aâ€¢ : Tyâ€¢ A}{t}{tâ€¢ : Tmâ€¢ Î“â€¢ Aâ€¢ t}{Ïƒ}{Ïƒâ€¢ : Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ}{Ï}{Ïâ€¢ : Subâ€¢ Î˜â€¢ Î”â€¢ Ï} â†’
             transpâŸ¨ Tmâ€¢ Î˜â€¢ Aâ€¢ âŸ© [][] (tâ€¢ [ Ïƒâ€¢ ]â€¢ [ Ïâ€¢ ]â€¢) â‰¡ tâ€¢ [ Ïƒâ€¢ âˆ˜â€¢ Ïâ€¢ ]â€¢
    q[]â€¢   : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{A}{Aâ€¢ : Tyâ€¢ A}{t}{tâ€¢ : Tmâ€¢ Î”â€¢ Aâ€¢ t}{Ïƒ}{Ïƒâ€¢ : Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ} â†’
             transpâŸ¨ Tmâ€¢ Î”â€¢ Aâ€¢ âŸ© q[] (qâ€¢ [ Ïƒâ€¢ â€£â€¢ tâ€¢ ]â€¢) â‰¡ tâ€¢
    lam[]â€¢ : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{A}{Aâ€¢ : Tyâ€¢ A}{B}{Bâ€¢ : Tyâ€¢ B}{t}{tâ€¢ : Tmâ€¢ (Î“â€¢ â–·â€¢ Aâ€¢) Bâ€¢ t}{Ïƒ}{Ïƒâ€¢ : Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ} â†’
             transpâŸ¨ Tmâ€¢ Î”â€¢ (Aâ€¢ â‡’â€¢ Bâ€¢) âŸ© lam[] ((lamâ€¢ tâ€¢) [ Ïƒâ€¢ ]â€¢) â‰¡ lamâ€¢ (tâ€¢ [ Ïƒâ€¢ âˆ˜â€¢ pâ€¢ â€£â€¢ qâ€¢ ]â€¢)
    $[]â€¢   : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{A}{Aâ€¢ : Tyâ€¢ A}{B}{Bâ€¢ : Tyâ€¢ B}{t}{tâ€¢ : Tmâ€¢ Î“â€¢ (Aâ€¢ â‡’â€¢ Bâ€¢) t}
             {u}{uâ€¢ : Tmâ€¢ Î“â€¢ Aâ€¢ u}{Ïƒ}{Ïƒâ€¢ : Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ} â†’
             transpâŸ¨ Tmâ€¢ Î”â€¢ Bâ€¢ âŸ© $[] ((tâ€¢ $â€¢ uâ€¢) [ Ïƒâ€¢ ]â€¢) â‰¡ (tâ€¢ [ Ïƒâ€¢ ]â€¢) $â€¢ (uâ€¢ [ Ïƒâ€¢ ]â€¢)
    t[id]â€¢ : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{A}{Aâ€¢ : Tyâ€¢ A}{t}{tâ€¢ : Tmâ€¢ Î“â€¢ Aâ€¢ t} â†’
             transpâŸ¨ Tmâ€¢ Î“â€¢ Aâ€¢ âŸ© t[id] (tâ€¢ [ idâ€¢ ]â€¢) â‰¡ tâ€¢
    assâ€¢   : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{Î˜}{Î˜â€¢ : Conâ€¢ Î˜}{Î©}{Î©â€¢ : Conâ€¢ Î©}
             {Ïƒ}{Ïƒâ€¢ : Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ}{Ï}{Ïâ€¢ : Subâ€¢ Î˜â€¢ Î”â€¢ Ï}{Î³}{Î³â€¢ : Subâ€¢ Î©â€¢ Î˜â€¢ Î³} â†’
             transpâŸ¨ Subâ€¢ Î©â€¢ Î“â€¢ âŸ© ass (Ïƒâ€¢ âˆ˜â€¢ (Ïâ€¢ âˆ˜â€¢ Î³â€¢)) â‰¡ (Ïƒâ€¢ âˆ˜â€¢ Ïâ€¢) âˆ˜â€¢ Î³â€¢
    idlâ€¢   : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{Ïƒ}{Ïƒâ€¢ : Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ} â†’
             transpâŸ¨ Subâ€¢ Î”â€¢ Î“â€¢ âŸ© idl (idâ€¢ âˆ˜â€¢ Ïƒâ€¢) â‰¡ Ïƒâ€¢
    idrâ€¢   : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{Ïƒ}{Ïƒâ€¢ : Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ} â†’
             transpâŸ¨ Subâ€¢ Î”â€¢ Î“â€¢ âŸ© idr (Ïƒâ€¢ âˆ˜â€¢ idâ€¢) â‰¡ Ïƒâ€¢
    â—‹Î·â€¢    : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Ïƒ}{Ïƒâ€¢ : Subâ€¢ Î“â€¢ â—‹â€¢ Ïƒ} â†’
             Ïƒâ€¢ â‰¡ Îµâ€¢
    â–·Î²â€¢    : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{A}{Aâ€¢ : Tyâ€¢ A}{Ïƒ}{Ïƒâ€¢ : Subâ€¢ Î”â€¢ Î“â€¢ Ïƒ}{t}{tâ€¢ : Tmâ€¢ Î”â€¢ Aâ€¢ t} â†’
             transpâŸ¨ Subâ€¢ Î”â€¢ Î“â€¢ âŸ© â–·Î² (pâ€¢ âˆ˜â€¢ (Ïƒâ€¢ â€£â€¢ tâ€¢)) â‰¡ Ïƒâ€¢
    â–·Î·â€¢    : âˆ€{Î“}{Î“â€¢ : Conâ€¢ Î“}{Î”}{Î”â€¢ : Conâ€¢ Î”}{A}{Aâ€¢ : Tyâ€¢ A}{Ïƒ}{Ïƒâ€¢ : Subâ€¢ Î”â€¢ (Î“â€¢ â–·â€¢ Aâ€¢) Ïƒ} â†’
             transpâŸ¨ Subâ€¢ Î”â€¢ (Î“â€¢ â–·â€¢ Aâ€¢) âŸ© â–·Î· (pâ€¢ âˆ˜â€¢ Ïƒâ€¢ â€£â€¢ qâ€¢ [ Ïƒâ€¢ ]â€¢) â‰¡ Ïƒâ€¢

  DMeqS* : DepModel
  DMeqS* = record
         { Conâ€¢   = Î» Î“ â†’ Conâ€¢ S*.âŸ¦ Î“ âŸ§C
         ; Tyâ€¢    = Î» A â†’ Tyâ€¢ S*.âŸ¦ A âŸ§T
         ; Subâ€¢   = Î» Î”â€¢ Î“â€¢ Ïƒ â†’ Subâ€¢ Î”â€¢ Î“â€¢ S*.âŸ¦ Ïƒ âŸ§S
         ; Tmâ€¢    = Î» Î“â€¢ Aâ€¢ t â†’ Tmâ€¢ Î“â€¢ Aâ€¢ S*.âŸ¦ t âŸ§t
         ; â—‹â€¢     = â—‹â€¢
         ; _â–·â€¢_   = Î» Î“â€¢ Aâ€¢ â†’ Î“â€¢ â–·â€¢ Aâ€¢
         ; _âˆ˜â€¢_   = Î» Ïƒâ€¢ Ïâ€¢ â†’ Ïƒâ€¢ âˆ˜â€¢ Ïâ€¢
         ; idâ€¢    = idâ€¢
         ; Îµâ€¢     = Îµâ€¢
         ; _â€£â€¢_   = Î» Ïƒâ€¢ tâ€¢ â†’ Ïƒâ€¢ â€£â€¢ tâ€¢
         ; pâ€¢     = pâ€¢
         ; Î¹â€¢     = Î¹â€¢
         ; _â‡’â€¢_   = _â‡’â€¢_
         ; _[_]â€¢  = Î» tâ€¢ Ïƒâ€¢ â†’ tâ€¢ [ Ïƒâ€¢ ]â€¢
         ; qâ€¢     = qâ€¢
         ; lamâ€¢   = lamâ€¢
         ; _$â€¢_   = Î» uâ€¢ vâ€¢ â†’ uâ€¢ $â€¢ vâ€¢
         ; Î²â€¢     = Î²â€¢
         ; Î·â€¢     = Î·â€¢
         ; [][]â€¢  = [][]â€¢
         ; q[]â€¢   = q[]â€¢
         ; lam[]â€¢ = lam[]â€¢
         ; $[]â€¢   = $[]â€¢
         ; t[id]â€¢ = t[id]â€¢
         ; assâ€¢   = assâ€¢
         ; idlâ€¢   = idlâ€¢
         ; idrâ€¢   = idrâ€¢
         ; â—‹Î·â€¢    = â—‹Î·â€¢
         ; â–·Î²â€¢    = â–·Î²â€¢
         ; â–·Î·â€¢    = â–·Î·â€¢
         }
  module DMeqS* = DepModel DMeqS*

  âŸ¦_âŸ§â€¢C     : (Î“ : Con) â†’ Conâ€¢ Î“
  âŸ¦_âŸ§â€¢T     : (A : Ty) â†’ Tyâ€¢ A
  postulate
    âŸ¦_âŸ§â€¢S   : {Î“ Î” : Con} â†’ (Ïƒ : Sub Î” Î“) â†’ Subâ€¢ âŸ¦ Î” âŸ§â€¢C âŸ¦ Î“ âŸ§â€¢C Ïƒ
    âŸ¦_âŸ§â€¢t   : {Î“ : Con}{A : Ty} â†’ (t : Tm Î“ A) â†’ Tmâ€¢ âŸ¦ Î“ âŸ§â€¢C âŸ¦ A âŸ§â€¢T t

  âŸ¦ I.â—‹ âŸ§â€¢C = â—‹â€¢
  âŸ¦ Î“ I.â–· A âŸ§â€¢C = âŸ¦ Î“ âŸ§â€¢C â–·â€¢ âŸ¦ A âŸ§â€¢T
  
  âŸ¦ I.Î¹ âŸ§â€¢T = Î¹â€¢
  âŸ¦ A I.â‡’ B âŸ§â€¢T = âŸ¦ A âŸ§â€¢T â‡’â€¢ âŸ¦ B âŸ§â€¢T

  postulate

    âŸ¦âˆ˜âŸ§â€¢S   : {Î“ Î” Î˜ : Con}{Ïƒ : Sub Î” Î“}{Ï : Sub Î˜ Î”} â†’ âŸ¦ Ïƒ âˆ˜ Ï âŸ§â€¢S â‰¡ âŸ¦ Ïƒ âŸ§â€¢S âˆ˜â€¢ âŸ¦ Ï âŸ§â€¢S
    âŸ¦idâŸ§â€¢S  : {Î“ : Con} â†’ âŸ¦ id {Î“} âŸ§â€¢S â‰¡ idâ€¢
    âŸ¦ÎµâŸ§â€¢S   : {Î“ : Con} â†’ âŸ¦_âŸ§â€¢S {I.â—‹}{Î“} â˜… â‰¡ Îµâ€¢
    âŸ¦â€£âŸ§â€¢S   : {Î“ Î” : Con}{Ïƒ : Sub Î” Î“}{A : Ty}{t : Tm Î” A} â†’ âŸ¦ Ïƒ â€£ t âŸ§â€¢S â‰¡ âŸ¦ Ïƒ âŸ§â€¢S â€£â€¢ âŸ¦ t âŸ§â€¢t
    âŸ¦pâŸ§â€¢S   : {Î“ : Con}{A : Ty} â†’ âŸ¦ p {Î“}{A} âŸ§â€¢S â‰¡ pâ€¢
    {-# REWRITE âŸ¦âˆ˜âŸ§â€¢S âŸ¦idâŸ§â€¢S âŸ¦ÎµâŸ§â€¢S âŸ¦â€£âŸ§â€¢S âŸ¦pâŸ§â€¢S #-}
    
    âŸ¦[]âŸ§â€¢t  : {Î“ Î” : Con}{A : Ty}{t : Tm Î“ A}{Ïƒ : Sub Î” Î“} â†’ âŸ¦ t [ Ïƒ ] âŸ§â€¢t â‰¡ âŸ¦ t âŸ§â€¢t [ âŸ¦ Ïƒ âŸ§â€¢S ]â€¢
    âŸ¦qâŸ§â€¢t   : {Î“ : Con}{A : Ty} â†’ âŸ¦ q {Î“}{A} âŸ§â€¢t â‰¡ qâ€¢
    âŸ¦lamâŸ§â€¢t : {Î“ : Con}{A B : Ty}{t : Tm (Î“ â–· A) B} â†’ âŸ¦ lam t âŸ§â€¢t â‰¡ lamâ€¢ âŸ¦ t âŸ§â€¢t
    âŸ¦$âŸ§â€¢t : {Î“ : Con}{A B : Ty}{t : Tm Î“ (A I.â‡’ B)}{u : Tm Î“ A} â†’ âŸ¦ t $ u âŸ§â€¢t â‰¡ âŸ¦ t âŸ§â€¢t $â€¢ âŸ¦ u âŸ§â€¢t
    {-# REWRITE âŸ¦[]âŸ§â€¢t âŸ¦qâŸ§â€¢t âŸ¦lamâŸ§â€¢t âŸ¦$âŸ§â€¢t #-}

open Model S*

-- for exemple, in this model this equation is definitional but will not be when strictifying more equations

ex : âˆ€{Î“ Î” Î˜}{A}{Ïƒ : Sub Î” Î“}{Ï : Sub Î˜ Î”}{t : Tm Î” A} â†’ (Ïƒ , t) âˆ˜ Ï â‰¡ (Ïƒ âˆ˜ Ï , t [ Ï ])
ex = refl
